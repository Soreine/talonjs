<html> <head> <title>Message Title</title> <meta http-equiv="X-UA-Compatible" content="IE=edge,chrome=1"> <meta http-equiv="content-type" content="text/html; charset=utf-8" /> <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0"> <base href="https://appdirect.jira.com/wiki"> <style type="text/css">@media only screen and (max-device-width: 480px) {.mobile-only { width: auto !important; height: auto !important; overflow: visible !important; line-height: normal !important; font-size: inherit !important; mso-hide: all; } .desktop-only { display: none !important; } /* iPhone 3GS fix for unwanted 20px right margin */ body { min-width: 100% !important; padding: 0; margin: 0; } #center-content-table { max-width: none; !important; } #header-pattern-container { padding: 10px 10px 10px 10px !important; line-height: 20px !important; } #header-avatar-image-container { padding-right: 8px !important; } #email-content-container { padding: 0 !important; } .mobile-expand { border-radius: 0 !important; border-left: 0 !important; border-right: 0 !important; padding-left: 26px !important; } .mobile-resize-text { font-size: 16px !important; line-height: 22px !important; } #page-title-pattern-header { font-size: 20px !important; line-height: 28px !important; } #page-title-pattern-icon-image-container-cell { padding-top: 7px !important; } #inline-user-pattern { display: block !important; } #inline-user-pattern-avatar { padding-top: 3px !important; } .contextual-area-pattern { border-bottom: 1px solid #ccc !important; padding: 15px 10px 0 10px !important; } .users-involved-pattern-column-table { width: 100% !important; } .users-involved-pattern-avatar-table-cell { padding: 3px 5px 5px 0 !important; } .users-involved-pattern-column-container { padding-right: 0 !important; } .contextual-excerpt-pattern, #users-involved-pattern { border: 0 !important; } /** Aui Typography upsized for mobile **/ #content-excerpt-pattern-container, #contextual-excerpt-pattern-text-container { font-size: 16px !important; line-height: 22px !important; } #content-excerpt-pattern-container h1, #contextual-excerpt-pattern-text-container h1 { font-size: 24px !important; line-height: 28px !important; } #content-excerpt-pattern-container h2, #contextual-excerpt-pattern-text-container h2 { font-size: 20px !important; line-height: 28px !important; } #content-excerpt-pattern-container h3, #contextual-excerpt-pattern-text-container h3 { font-size: 18px !important; line-height: 24px !important; } #content-excerpt-pattern-container h4, #contextual-excerpt-pattern-text-container h4 { font-size: 16px !important; line-height: 22px !important; } #content-excerpt-pattern-container h5, #contextual-excerpt-pattern-text-container h5 { font-size: 14px !important; line-height: 20px !important; } #content-excerpt-pattern-container h6, #contextual-excerpt-pattern-text-container h6 { font-size: 14px !important; line-height: 20px !important; } .user-mention { line-height: 18px !important; } /** Aui Typography end **/ /* Show appropriate footer logo on mobile, display links vertically */ #footer-pattern { padding: 15px 10px !important; } #footer-pattern-logo-desktop-container { padding: 0 !important; } #footer-pattern-logo-desktop { width: 0 !important; height: 0 !important; } #footer-pattern-logo-mobile { padding-top: 10px !important; width: 30px !important; height: 27px !important; display: inline !important; } #footer-pattern-text { display: block !important; } #footer-pattern-links-container { line-height: 0 !important; } .footer-pattern-links.mobile-resize-text, .footer-pattern-links.mobile-resize-text, #footer-pattern-text.mobile-resize-text, #footer-pattern-links-container.no-footer-links { font-size: 14px !important; line-height: 20px !important; } .footer-link { display: block !important; } #footer-pattern-links-container table { display: inline-block !important; float: none !important; } #footer-pattern-links-container, #footer-pattern-text { text-align: center !important; } #footer-pattern-links { padding-bottom: 5px !important; } /** Team Calendar overrides, these should be removed when notifications are updated in Team Calendars. For now CSS overrides are being used because the structure of the content can't change without rereleasing the plugin */ .mail-calendar-container .day-header + table tr td:first-child { vertical-align: top !important; padding-top: 5px !important; }.header-pattern-container { padding: 10px 10px 10px 0px !important; line-height: 20px !important; } .header-avatar-image-container { padding-right: 8px !important; } .mobile-expand { border-radius: 0 !important; border-left: 0 !important; border-right: 0 !important; padding-left: 0px !important; }} @media (min-width: 900px) {#center-content-table { width: 900px; }} @media all {#outlook a { padding: 0; } /* Force Outlook to provide a "view in browser" menu link. */ /* Prevent Webkit and Windows Mobile platforms from changing default font sizes.*/ body { -webkit-text-size-adjust: 100%; -ms-text-size-adjust: 100%; } .ExternalClass { width: 100%; } /* Force Hotmail to display emails at full width */ #background-table { margin: 0; padding: 0; width: 100% !important; } /* Needed to override highlighting on date and time links in iOS */ .grey a { color: #707070; text-decoration: none; }/* These styles are appended to the head element of a notification in order to prevent Apple Mail and similar clients from underlining the due dates with a blue hyperlink */ /* a lozenge outside an inline task should always be #333, lozenges inside an inline task should be colored according to their upcoming due dates, a completed task date lozenge or deleted task date lozenge should always be #707070 */ .date-time-lozenge a {color: #333333; text-decoration: none; } .inline-task-text-container .date-time-lozenge.date-upcoming a {color: #DF6F00; text-decoration: none; } .inline-task-text-container .date-time-lozenge.date-past a {color: #D04437; text-decoration: none; } .inline-task-text-container.content-deleted-color .date-time-lozenge a, .inline-task-text-container.checked .date-time-lozenge a { color: #707070; text-decoration: none; }} </style> </head> <body> <table id="background-table" cellpadding="0" cellspacing="0" width="100%" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; background-color: #f5f5f5; background-color: #f5f5f5; font-family: Helvetica, Arial, sans-serif" bgcolor="#f5f5f5"> <tbody> <tr> <td id="batch-summary" cellspacing="0" cellpadding="0" border="0" style="padding: 0px; border-collapse: collapse; padding: 15px 20px">There's <strong class="batch-section-summary">2 new edits</strong> on this page</td> </tr> <tr> <td id="email-content-container" style="padding: 0px; border-collapse: collapse; padding: 0 20px"> <table id="email-content-table" cellspacing="0" cellpadding="0" border="0" width="100%" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; border-spacing: 0; border-collapse: separate; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td class="email-content-rounded-top mobile-expand" style="padding: 0px; border-collapse: collapse; color: #ffffff; padding: 0 15px 0 16px; height: 15px; background-color: #ffffff; border-left: 1px solid #cccccc; border-top: 1px solid #cccccc; border-right: 1px solid #cccccc; border-bottom: 0; border-top-right-radius: 5px; border-top-left-radius: 5px; color: #ffffff; padding: 0 15px 0 16px; height: 15px; line-height: 15px; background-color: #ffffff; border-left: 1px solid #cccccc; border-top: 1px solid #cccccc; border-right: 1px solid #cccccc; border-bottom: 0; border-top-right-radius: 5px; border-top-left-radius: 5px" height="15" bgcolor="#ffffff">&nbsp;</td> </tr> <tr> <td class="email-content-main mobile-expand" style="padding: 0px; border-collapse: collapse; border-left: 1px solid #cccccc; border-right: 1px solid #cccccc; border-top: 0; border-bottom: 0; padding: 0 15px 15px 16px; background-color: #ffffff; border-left: 1px solid #cccccc; border-right: 1px solid #cccccc; border-top: 0; border-bottom: 0; padding: 0; background-color: #ffffff" bgcolor="#ffffff"> <table id="page-title-pattern" cellspacing="0" cellpadding="0" border="0" width="100%" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td id="page-title-pattern-icon-image-container" valign="top" style="padding: 0px; border-collapse: collapse; width: 16px; vertical-align: top; padding-left: 20px" width="16"> <table cellspacing="0" cellpadding="0" border="0" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td id="page-title-pattern-icon-image-container-cell" style="padding: 0px; border-collapse: collapse; width: 16px; padding: 9px 8px 0px 0px; mso-text-raise: 5px; mso-line-height-rule: exactly" width="16"><a href="https://appdirect.jira.com/wiki/display/OP/Database+Disaster+Recovery+between+Regions?src=mail&amp;src.mail.timestamp=1463436434797&amp;src.mail.notification=com.atlassian.confluence.plugins.confluence-notifications-batch-plugin%3Abatching-notification&amp;src.mail.recipient=ff80808142b0de850142b4c816c40003&amp;src.mail.action=view" title="page icon" style="vertical-align: top;; color: #3b73af; text-decoration: none"><img style="vertical-align: top; display: block;" src="cid:page-icon" alt="page icon" title="page icon" height="16" width="16" border="0"></a></td> </tr> </tbody> </table> </td> <td style="vertical-align: top;; padding: 0px; border-collapse: collapse; padding-right: 5px; font-size: 20px; line-height: 30px; mso-line-height-rule: exactly" id="page-title-pattern-header-container"><span id="page-title-pattern-header" style="font-family: Arial, sans-serif; padding: 0; font-size: 20px; line-height: 30px; mso-text-raise: 2px; mso-line-height-rule: exactly; vertical-align: middle"><a href="https://appdirect.jira.com/wiki/display/OP/Database+Disaster+Recovery+between+Regions?src=mail&amp;src.mail.timestamp=1463436434797&amp;src.mail.notification=com.atlassian.confluence.plugins.confluence-notifications-batch-plugin%3Abatching-notification&amp;src.mail.recipient=ff80808142b0de850142b4c816c40003&amp;src.mail.action=view" title="Database Disaster Recovery between Regions" style="color: #3b73af; text-decoration: none; color: #3572b0">Database Disaster Recovery between Regions</a></span></td> </tr> </tbody> </table> </td> </tr> <tr> <td class="email-content-main mobile-expand last-row-padding" style="padding: 0px; border-collapse: collapse; border-left: 1px solid #cccccc; border-right: 1px solid #cccccc; border-top: 0; border-bottom: 0; padding: 0 15px 15px 16px; background-color: #ffffff; padding-bottom: 10px; border-left: 1px solid #cccccc; border-right: 1px solid #cccccc; border-top: 0; border-bottom: 0; padding: 0; background-color: #ffffff" bgcolor="#ffffff"> <table class="batch-section" cellspacing="0" cellpadding="0" border="0" width="100%" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td class="batch-section-content" style="padding: 0px; border-collapse: collapse; padding: 0px 20px"> <table class="batch-group" cellspacing="0" cellpadding="0" border="0" width="100%" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td style="padding: 0px; border-collapse: collapse"> <table class="batch-line" cellspacing="0" cellpadding="0" border="0" width="100%" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td style="padding: 0px; border-collapse: collapse"> <table cellspacing="0" cellpadding="0" border="0" width="100%" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td class="header-pattern-container batch-comment" style="padding: 0px; border-collapse: collapse; padding: 0; padding-top: 20px"> <table class="header-pattern" cellspacing="0" cellpadding="0" boder="0" width="100%" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td class="header-avatar-image-container" valign="top" style="padding: 0px; border-collapse: collapse; vertical-align: top; width: 32px; padding-right: 9px" width="32"><img class="header-avatar-image image_fix" src="cid:avatar_3f240f7586e6c672241464547a211abc" height="32" width="32" border="0" style="border-radius: 3px; vertical-align: top"></td> <td class="header-text-container " valign="middle" style="padding: 0px; border-collapse: collapse; vertical-align: middle; font-family: Arial, sans-serif; font-size: 14px; line-height: 20px; mso-line-height-rule: exactly; mso-text-raise: 1px"> <table align="left" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td valign="middle" style="padding: 0px; border-collapse: collapse"><span class="batch-message"><span class="batch-user-fullname" style="font-size: 16px; font-weight: bold">Bruce Adams</span> edited this page</span></td> </tr> </tbody> </table> </td> </tr> <tr> <td class="batch-comment-split" style="padding: 0px; border-collapse: collapse; padding-top: 20px; border-bottom: 1px solid #e9e9e9"></td> <td class="batch-comment-split" style="padding: 0px; border-collapse: collapse; padding-top: 20px; border-bottom: 1px solid #e9e9e9"></td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="batch-group" cellspacing="0" cellpadding="0" border="0" width="100%" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td style="padding: 0px; border-collapse: collapse"> <table class="batch-line" cellspacing="0" cellpadding="0" border="0" width="100%" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td style="padding: 0px; border-collapse: collapse"> <table class="batch-html-title" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td style="padding: 0px; border-collapse: collapse; padding-top: 15px; font-size: 14px"><span class="batch-message">Here's what changed:</span></td> </tr> </tbody> </table> <table class="batch-html batch-html-border " cellspacing="0" cellpadding="0" border="0" width="100%" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif; border: 1px solid #e4e4e4; Margin: 20px 0 0; overflow-x: auto"> <tbody> <tr> <td style="padding: 0px; border-collapse: collapse; padding: 10px"> <table class="content-excerpt-pattern" cellspacing="0" cellpadding="0" border="0" width="100%" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Arial, sans-serif; font-size: 14px; line-height: 20px; mso-line-height-rule: exactly; mso-text-raise: 1px; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td class="content-excerpt-pattern-container mobile-resize-text " style="padding: 0px; border-collapse: collapse; padding: 0 0 0 24px; padding: 0; padding: 10px"> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0; margin-top: 0">This will be a step by step process on how to build out a geo-distributed database environment that will survive a disaster. The environment is a&nbsp;fictitious&nbsp;AWS environment using SSD based disk and provisioned IOPS, but could any environment that spans data centers. <span class="diff-html-removed" id="removed-diff-0" style="font-size: 100%; background-color: #ffe7e7; text-decoration: line-through;">&nbsp;</span><span class="diff-html-added" id="added-diff-0" style="font-size: 100%; background-color: #ddfade;">Also this documents assumes the DBA already knows all the details of Percona XtraDB Cluster and MySQL Replication.</span> <br> <br> <strong>Architecture</strong>&nbsp;<br> <span class="diff-html-removed" id="removed-diff-1" style="font-size: 100%; background-color: #ffe7e7; text-decoration: line-through;">&nbsp;</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-removed" style="font-size: 100%; background-color: #ffe7e7; text-decoration: line-through;">&nbsp;</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-removed" style="font-size: 100%; background-color: #ffe7e7; text-decoration: line-through;">&nbsp;</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="confluence-embedded-file-wrapper confluence-embedded-manual-size"><span class="diff-html-added diff-html-image-container" id="added-diff-1" style="background-color: #ddfade;display: inline-block;position: relative;text-align: center;"><img class="confluence-embedded-image" height="250" src="/wiki/download/attachments/104202404/DR%20Recovery%20Replication%20Model%20-%20New%20Page.png?version=2&amp;modificationDate=1463432292907&amp;api=v2" data-image-src="/wiki/download/attachments/104202404/DR%20Recovery%20Replication%20Model%20-%20New%20Page.png?version=2&amp;modificationDate=1463432292907&amp;api=v2" data-unresolved-comment-count="0" data-linked-resource-id="136806570" data-linked-resource-version="2" data-linked-resource-type="attachment" data-linked-resource-default-alias="DR Recovery Replication Model - New Page.png" data-base-url="https://appdirect.jira.com/wiki" data-linked-resource-content-type="image/png" data-linked-resource-container-id="104202404" data-linked-resource-container-version="8"><span class="diff-image-overlay diff-added-image" style="color: #535353;display: block;padding: 4px 4px 8px 4px;text-decoration: none;">Image Added</span></span></span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">The architecture is built to be distributed, each system can be in a different network, availability zone, or different data centers in different states. The design has a copy of the database in four different locations. In the diagram we have the master cluster located in asw00 availability zone 1. The replication server aws01 in availability zone 2, replication server aws02 in availability zone 3 and finally the slave cluster in availability zone 4.&nbsp;</span> </p> <p class="diff-block-context" style="margin: 10px 0 0 0"> <strong>Preliminary Steps</strong> <br>A) Grants required for MySQL replication to work.&nbsp;On any primary cluster node add the mysql grants for a replication user.</p> <p class="diff-context-placeholder" style="margin: 10px 0 0 0">...</p> <p class="diff-block-target" style="margin: 10px 0 0 0">B) Server Configuration, modify /etc/my_include.cnf, all settings are in the [mysqld] section.&nbsp;<br> <span style="line-height: 20.0px;"><span class="diff-html-removed" id="removed-diff-2" style="font-size: 100%; background-color: #ffe7e7; text-decoration: line-through;">&nbsp;</span></span> <br> <strong><span class="diff-html-changed" id="changed-diff-0" style="background-color: #d6f0ff;">Master Cluster 1 DB node</span></strong> </p> <p class="diff-block-context" style="margin: 10px 0 0 0"> <span style="line-height: 20.0px;">expire_logs_days = 10</span> </p> <p class="diff-block-context" style="margin: 10px 0 0 0"> <span style="line-height: 20.0px;"><strong>Replication ... both servers<br> </strong>innodb_buffer_pool_instances = 5<br>innodb_buffer_pool_size = 30G<br>innodb_flush_neighbors = 0<br>innodb_adaptive_flushing = 1<br>innodb_log_block_size = 4096<br>innodb_io_capacity = 13000<br>innodb_io_capacity = 12000<br>innodb_cleaner_lsn_age_factor = high_checkpoint<br>innodb_lru_scan_depth = 12000<br>expire_logs_days = 10<br>innodb_flush_log_at_trx_commit = 1<br>relay-log-recovery = 1<br>relay-log-info-repository = FILE<br>relay_log_purge = 1<br>binlog_checksum = CRC32<br>master_verify_checksum = ON<br>binlog_rows_query_log_events = ON&nbsp;</span> </p> <p class="diff-block-target" style="margin: 10px 0 0 0"> <strong style="line-height: 1.42857;"><span class="diff-html-changed" id="changed-diff-2" style="background-color: #d6f0ff;">Slave Cluster 1 DB</span></strong><span class="diff-html-changed" style="background-color: #d6f0ff;"> </span>node</p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0">innodb_flush_neighbors = 0<br>innodb_adaptive_flushing = 1<br>innodb_log_block_size = 4096<br>innodb_cleaner_lsn_age_factor = high_checkpoint<br>log-slave-updates<br>wsrep-restart-slave = <span class="diff-html-removed" id="removed-diff-3" style="font-size: 100%; background-color: #ffe7e7; text-decoration: line-through;">1&nbsp;</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-removed" style="font-size: 100%; background-color: #ffe7e7; text-decoration: line-through;">&nbsp;</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" id="added-diff-2" style="font-size: 100%; background-color: #ddfade;">1</span> <br> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">These settings may change on environmental changes, they are suggested and should be researched if changed. Many of the settings specifically for the Replication servers SHOULD NOT BE APPLIED to the cluster servers, many of the settings cause Galera to crash.</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <strong><span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">Step 1 :: Connect Primary Cluster in Zone 1 to Replication Server in Zone 2</span> <br> </strong><strong><span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">Dump master to Slave</span></strong> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">ssh prod-aws00-db04 "sudo innobackupex --stream=xbstream --user=mysql \</span> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">--host=localhost --password=xxx&nbsp;--use-memory=8G --parallel=8 ./"|xbstream -x -C /var/lib/mysql</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <strong><span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">Build Redo Logs run 2 times</span></strong> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">innobackupex --user=mysql --password=xxx --host=localhost --use-memory=4G \</span> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">--apply-log /var/lib/mysql</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">you should see ... innobackupex: completed OK! ... when log creation is done</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">innobackupex --user=mysql --password=xxx --host=localhost --use-memory=4G \</span> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">--apply-log /var/lib/mysql</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">you should see ... innobackupex: completed OK! ... when log creation is done</span> <br> <br> <strong><span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">Next get binlog position and filename</span></strong> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">cat /var/lib/mysql/xtrabackup_binlog_info</span> </p> <p class="p1 diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="s1"><span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">mysql-bin.002730 &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; 343100195 &nbsp; &nbsp; ... Example Contents</span></span> <br> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">I create a change_master.sql file in /home/mysql/scripts directory, I update the file name and position the rest I have filled out with hostnames, passwords to save time. &nbsp;Example</span> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">change master to</span> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">master_host='prod-aws00-db04',</span> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">master_user='repl',</span> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">master_password='xxx',</span> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">master_log_file='mysql-bin.002730',</span> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">master_log_position=343100195;</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&nbsp;</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <strong><span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">Fix any file permissions, softlinks on prod-aws01-rep01</span></strong> <br> <br> <strong><span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&nbsp;Start MySQL on prod-aws01-rep01</span></strong> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&gt; stop slave;</span> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&gt; reset slave;</span> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&gt; source /home/mysql/scripts/change_master.sql</span> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&gt; start slave;</span> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&gt; show slave status\G</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">Replication threads should both be Yes ... if not troubleshoot the typical replication problems</span> <br> <br> <strong><span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">Confirm the following</span></strong> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">In /var/lib/mysql</span> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">ln -s /database/conf/.my.cnf /var/lib/mysql/.my.cnf</span> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">ln -s /var/run/mysqld/mysqld.sock /var/lib/mysql/mysql.sock</span> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">chown -h mysql.mysql .my.cnf mysql.sock .. if needed</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">Failure to set the links will effect the cluster check script and xtrabackup script</span> <br> <br> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&nbsp;</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&nbsp;</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&nbsp;</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&nbsp;</span> </p> <p class="p1 diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&nbsp;</span> </p> <p class="p1 diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&nbsp;</span> </p> <p class="p1 diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&nbsp;</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&nbsp;</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&nbsp;</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&nbsp;</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&nbsp;</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&nbsp;</span> </p> <p class="diff-block-target diff-block-context" style="margin: 10px 0 0 0"> <span class="diff-html-added" style="font-size: 100%; background-color: #ddfade;">&nbsp;</span> </p> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="batch-group" cellspacing="0" cellpadding="0" border="0" width="100%" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td style="padding: 0px; border-collapse: collapse"> <table class="batch-line" cellspacing="0" cellpadding="0" border="0" width="100%" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td style="padding: 0px; border-collapse: collapse"> <table class="batch-actions actions-pattern" cellspacing="0" cellpadding="0" border="0" width="100%" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif; font-family: Arial, sans-serif; font-size: 14px; line-height: 20px; mso-line-height-rule: exactly; mso-text-raise: 1px"> <tbody> <tr> <td class="actions-pattern-container" valign="middle" style="padding: 0px; border-collapse: collapse; padding-top: 10px; vertical-align: middle"> <table style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td class="actions-pattern-action-text-container" style="padding: 0px; border-collapse: collapse; font-family: Arial, sans-serif; font-size: 14px; line-height: 20px; mso-line-height-rule: exactly; mso-text-raise: 4px; padding-left: 5px; white-space: nowrap; font-family: Arial, sans-serif; font-size: 14px; line-height: 20px; mso-line-height-rule: exactly; mso-text-raise: 4px; padding-left: 0px; white-space: nowrap"><a href="https://appdirect.jira.com/wiki/pages/viewpreviousversions.action?pageId=104202404&amp;src=mail&amp;src.mail.timestamp=1463436434797&amp;src.mail.notification=com.atlassian.confluence.plugins.confluence-notifications-batch-plugin%3Abatching-notification&amp;src.mail.recipient=ff80808142b0de850142b4c816c40003" title="Go to page history" style="color: #3b73af; text-decoration: none; color: #707070">Go to page history</a></td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table class="batch-section-split" cellspacing="0" cellpadding="0" border="0" width="100%" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td style="padding: 0px; border-collapse: collapse; border-bottom: 1px solid #cccccc; padding-bottom: 20px"></td> </tr> </tbody> </table> <table cellspacing="0" cellpadding="0" border="0" width="100%" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td id="batch-call-action" style="padding: 0px; border-collapse: collapse; padding: 20px"> <table cellspacing="0" cellpadding="0" border="0" class="aui-button-email-container" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td class="aui-button-email" style="background: #2b71b9; -moz-box-sizing: border-box; -webkit-font-smoothing: antialiased;; padding: 0px; border-collapse: collapse; border-radius: 3px; padding: 5px; margin: 0px"><a href="https://appdirect.jira.com/wiki/display/OP/Database+Disaster+Recovery+between+Regions?src=mail&amp;src.mail.timestamp=1463436434797&amp;src.mail.notification=com.atlassian.confluence.plugins.confluence-notifications-batch-plugin%3Abatching-notification&amp;src.mail.recipient=ff80808142b0de850142b4c816c40003&amp;src.mail.action=view" class="aui-button-email-link" style="color: #3b73af; text-decoration: none; color: #ffffff; font-weight: bold; padding: 6px; font-size: 14px; line-height: 1.429; font-family: Arial, sans-serif">View page</a></td> </tr> </tbody> </table> </td> </tr> </tbody> </table> </td> </tr> <tr> <td class="email-content-rounded-bottom mobile-expand" style="padding: 0px; border-collapse: collapse; color: #ffffff; height: 5px; line-height: 5px; padding: 0 15px 0 16px; background-color: #ffffff; border-bottom-right-radius: 5px; border-bottom-left-radius: 5px; border-top: 0; border-left: 1px solid #cccccc; border-bottom: 1px solid #cccccc; border-right: 1px solid #cccccc; mso-line-height-rule: exactly; color: #ffffff; height: 5px; line-height: 5px; padding: 0 15px 0 16px; background-color: #ffffff; border-bottom-right-radius: 5px; border-bottom-left-radius: 5px; border-top: 0; border-left: 1px solid #cccccc; border-bottom: 1px solid #cccccc; border-right: 1px solid #cccccc; mso-line-height-rule: exactly" height="5" bgcolor="#ffffff">&nbsp;</td> </tr> </tbody> </table> </td> </tr> <tr> <td id="footer-pattern" style="padding: 0px; border-collapse: collapse; padding: 12px 20px"> <table id="footer-pattern-container" cellspacing="0" cellpadding="0" border="0" width="100%" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td id="footer-pattern-links-container" width="100%" style="padding: 0px; border-collapse: collapse; color: #999999; font-size: 12px; line-height: 18px; font-family: Arial, sans-serif; mso-line-height-rule: exactly; mso-text-raise: 2px"> <table align="left" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-size: 12px; line-height: 18px; font-family: Arial, sans-serif; mso-line-height-rule: exactly; mso-text-raise: 2px; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td class="footer-pattern-links mobile-resize-text" style="padding: 0px; border-collapse: collapse"><a href="https://appdirect.jira.com/wiki/users/removespacenotification.action?spaceKey=OP&amp;src=mail&amp;src.mail.timestamp=1463436434797&amp;src.mail.notification=com.atlassian.confluence.plugins.confluence-notifications-batch-plugin%3Abatching-notification&amp;src.mail.recipient=ff80808142b0de850142b4c816c40003&amp;src.mail.action=stop-watching&amp;jwt=eyJ0eXAiOiJKV1QiLCJhbGciOiJIUzI1NiJ9.eyJzdWIiOiJ4c3JmOmZmODA4MDgxNDJiMGRlODUwMTQyYjRjODE2YzQwMDAzIiwicXNoIjoiYzY0ODYzMGQ2YTFhZDVhMzZjMDdiZjM2MzUzODNlZmJiODQxODQ1OWEyNDZlMTdmMDUyMjU4NWE5OWJhN2U3NyIsImlzcyI6ImNvbmZsdWVuY2Vfbm90aWZpY2F0aW9uc0JIRlYtT1FWQS1YNTQyLTNNRFIiLCJleHAiOjE0NjQwNDEyMzQsImlhdCI6MTQ2MzQzNjQzNH0.S2tofwTJ0T6jJgjOMKVHW-Hd-vViq_vCfO1IdQDpz2M" title="" style="color: #3b73af; text-decoration: none; color: #2b71b9">Stop watching space</a></td> <td class="footer-pattern-links-bull" style="padding: 0px; border-collapse: collapse; padding: 0 5px; color: #999999">â€¢</td> </tr> </tbody> </table> <table style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; font-size: 12px; line-height: 18px; font-family: Arial, sans-serif; mso-line-height-rule: exactly; mso-text-raise: 2px; font-family: Helvetica, Arial, sans-serif"> <tbody> <tr> <td class="footer-pattern-links mobile-resize-text" style="padding: 0px; border-collapse: collapse"><a href="https://appdirect.jira.com/wiki/users/editmyemailsettings.action?src=mail&amp;src.mail.timestamp=1463436434797&amp;src.mail.notification=com.atlassian.confluence.plugins.confluence-notifications-batch-plugin%3Abatching-notification&amp;src.mail.recipient=ff80808142b0de850142b4c816c40003&amp;src.mail.action=manage" title="" style="color: #3b73af; text-decoration: none; color: #2b71b9">Manage notifications</a></td> </tr> </tbody> </table> </td> </tr> <tr> <td id="footer-pattern-text" class="mobile-resize-text" width="100%" style="padding: 0px; border-collapse: collapse; color: #999999; font-size: 12px; line-height: 18px; font-family: Arial, sans-serif; mso-line-height-rule: exactly; mso-text-raise: 2px; display: none">This message was sent by Atlassian Confluence 1000.88.0</td> </tr> </tbody> </table> </td> </tr> </tbody> </table> <table id="sealed-section" border="0" cellpadding="0" cellspacing="0" width="0" style="border-collapse: collapse; mso-table-lspace: 0pt; mso-table-rspace: 0pt; color: #333333; display: none; mso-hide: all"> <tbody> <tr> <td style="padding: 0px; border-collapse: collapse; border: 0; font-size: 0px; line-height: 0; mso-line-height-rule: exactly"></td> </tr> </tbody> </table> </body> </html>
